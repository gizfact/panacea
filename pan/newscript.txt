/* BILLS - KKM smallint default 0 */
ALTER TABLE BILLS ADD KKM Smallint default 0;

UPDATE BILLS SET KKM=1;

CREATE TABLE SERVNAMES
(
  SERVICEID Bigint NOT NULL,
  NAME Varchar(128) NOT NULL,
  PRIMARY KEY (SERVICEID)
);

CREATE TABLE KKM
(
  ROWID Bigint NOT NULL,
  OPDATE Decimal(18,13) NOT NULL,
  SUMM Decimal(18,13) NOT NULL,
  STARID Bigint NOT NULL,
  PRIMARY KEY (ROWID)
);

CREATE GENERATOR GEN_KKM_ROWID;

SET TERM ^ ;
CREATE TRIGGER TRI_KKM_BI FOR KKM ACTIVE
BEFORE INSERT POSITION 0
AS 
BEGIN 
    /* enter trigger code here */
    if (NEW.ROWID=0 or NEW.ROWID is null) then
    begin
    NEW.ROWID=gen_id(GEN_KKM_ROWID,1); 
    end
END^
SET TERM ; ^

INSERT INTO SERVNAMES SELECT ROWID,TAG||NAME FROM SERVICES;
